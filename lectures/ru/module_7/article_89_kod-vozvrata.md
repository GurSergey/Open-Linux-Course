Каждый процесс, завершившись, возвращает родительскому процессу какое-то значение, называемое кодом завершения или кодом возврата. По соглашению разработчиков, нулевой код возврата означает успешное завершение, а ненулевые — разнообразные ошибки. Процесс-родитель может приостановить свое выполнение до завершения потомка и выполнить разные действия в зависимости от возвращенного дочерним процессом значения, а может и не делать этого.


Есть формальное соглашения между разработчиками Bash и теми кто пишет прикладные скрипты, эти соглашения описаны в таблице ниже




|  |  |  |  |
| --- | --- | --- | --- |
| Код завершения | Смысл | Пример | Примечание |
| 1 | разнообразные ошибки | var1 = 1/0 | различные ошибки, такие как "деление на ноль" и пр. |
| 2 | согласно документации к Bash -- неверное использование встроенных команд |  | Встречаются довольно редко, обычно код завершения возвращается равным 1 |
| 126 |  вызываемая команда не может быть выполнена |  | возникает из-за проблем с правами доступа или когда вызван на исполнение неисполняемый файл |
| 127 | "команда не найдена"  |  | Проблема связана либо с переменной окружения $PATH, либо с неверным написанием имени команды |
| 128 | неверный аргумент команды exit   | exit 3.14159 | команда exit может принимать только целочисленные значения, в диапазоне 0 - 255 |
| 128+n | фатальная ошибка по сигналу "n"  |  kill -9 $PPID сценария | $? вернет 137 (128 + 9) |
| 130 | завершение по Control-C  | Control-C | -- это выход по сигналу 2, (130 = 128 + 2, см. выше) |
| 255\*  | код завершения вне допустимого диапазона | exit -1  | exit может принимать только целочисленные значения, в диапазоне 0 - 255 |


 


Согласно этой таблице, коды завершения 1 - 2, 126 - 165 и 255 [1] имеют предопределенное значение, поэтому вам следует избегать употребления этих кодов для своих нужд. Завершение сценария с кодом возврата exit 127, может привести в замешательство при поиске ошибок в сценарии (действительно ли он означает ошибку "команда не найдена"? Или это предусмотренный программистом код завершения?). В большинстве случаев, программисты вставляют exit 1, в качестве реакции на ошибку. Так как код завершения 1 подразумевает целый "букет" ошибок, то в данном случае трудно говорить о какой либо двусмысленности, хотя и об информативности -- тоже.


Обращение к переменной $?, из командной строки, после завершения работы сценария или программы, дает возможность узнать с каким кодом завершился процесс


Вы также можете возвращать из своих скриптов коды возрата. Для этого есть команда exit. Давайте немного модифицируем наш скрипт   
`echo "Current directory is:"`  
`pwd`  
`exit 123`


Сохраним и запустим  
`$ bash 1.sh`  
`Current directory is:`  
`/home/gurylevsv`  
`$ echo $?`  
`123`


Мы видим, что наш скрипт вернул код 123 как мы и планировали

