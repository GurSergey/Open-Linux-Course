Sed - это неинтерактивный строчный редактор. Он принимает текст либо с устройства stdin, либо из текстового файла, выполняет некоторые операции над строками и затем выводит результат на устройство stdout или в файл. Как правило, в сценариях, sed используется в конвейерной обработке данных, совместно с другими командами и утилитами.  
Сначала рассмотрим синтаксис команды:


`$ sed опции -e команды файл`


А вот её основные опции:


-n, --quiet - не выводить содержимое буфера шаблона в конце каждой итерации;  
-e - команды, которые надо выполнить для редактирования;  
-f - прочитать команды редактирования из файла;  
-i - сделать резервную копию файла перед редактированием;  
-l - указать свою длину строки;  
-r - включить поддержку расширенного синтаксиса регулярных выражений;  
-s - если передано несколько файлов, рассматривать их как отдельные потоки, а не как один длинный.


**Как работает sed**  
Теперь нужно понять как работает команда sed. У утилиты есть два буфера, это активный буфер шаблона и дополнительный буфер. Оба изначально пусты. Программа выполняет заданные условия для каждой строки в переданном ей файле.


sed читает одну строку, удаляет из неё все завершающие символы и символы новой строки и помещает её в буфер шаблона. Затем выполняются переданные в параметрах команды, с каждой командой может быть связан адрес, это своего рода условие и команда выполняется только если подходит условие.


Когда всё команды будут выполнены и не указана опция -n, содержимое буфера шаблона выводится в стандартный поток вывода перед этим добавляется обратно символ перевода строки. если он был удален. Затем запускается новая итерация цикла для следующей строки.


Если не используются специальные команды, например, D, то после завершения одной итерации цикла содержимое буфера шаблона удаляется. Однако содержимое предыдущей строки хранится в дополнительном буфере и его можно использовать.


Каждой команде можно передать адрес, который будет указывать на строки, для которых она будет выполнена:


номер - позволяет указать номер строки, в которой надо выполнять команду;  
первая~шаг - команда будет выполняется для указанной в первой части сроки, а затем для всех с указанным шагом;  
$ - последняя строка в файле;  
/регулярное\_выражение/ - любая строка, которая подходит по регулярному выражению. Модификатор l указывает, что регулярное выражение должно быть не чувствительным к регистру;  
номер, номер - начиная от строки из первой части и заканчивая строкой из второй части;  
номер, /регулярное\_выражение/ - начиная от сроки из первой части и до сроки, которая будет соответствовать регулярному выражению;  
номер, +количество - начиная от номера строки указанного в первой части и еще плюс количество строк после него;  
номер, ~число - начиная от строки номер и до строки номер которой будет кратный числу.  
Если для команды не был задан адрес, то она будет выполнена для всех строк. Если передан один адрес, команда будет выполнена только для строки по этому адресу. Также можно передать диапазон адресов. Тогда адреса разделяются запятой и команда будет выполнена для всех адресов диапазона.


**Синтаксис регулярных выражений**  
Вы можете использовать такие же регулярные выражения, как и для Bash и популярных языков программирования. Вот основные операторы, которые поддерживают регулярные выражения sed Linux:


\* - любой символ, любое количество;  
\+ - как звездочка, только один символ или больше;  
\? - нет или один символ;  
\{i\} - любой символ в количестве i;  
\{i,j\} - любой символ в количестве от i до j;  
\{i,\} - любой символ в количестве от i и больше.  
**Команды sed**  
Если вы хотите пользоваться sed, вам нужно знать команды редактирования. Рассмотрим самые часто применяемые из них:


# - комментарий, не выполняется;  
q - завершает работу сценария;  
d - удаляет буфер шаблона и запускает следующую итерацию цикла;  
p - вывести содержимое буфера шаблона;  
n - вывести содержимое буфера шаблона и прочитать в него следующую строку;  
s/что\_заменять/на\_что\_заменять/опции - замена символов, поддерживаются регулярные выражения;  
y/символы/символы - позволяет заменить символы из первой части на соответствующие символы из второй части;  
w - записать содержимое буфера шаблона в файл;  
N - добавить перевод строки к буферу шаблона;  
D - если буфер шаблона не содержит новую строку, удалить его содержимое и начать новую итерацию цикла, иначе удалить содержимое буфера до символа перевода строки и начать новую итерацию цикла с тем, что останется;  
g - заменить содержимое буфера шаблона, содержимым дополнительного буфера;  
G - добавить новую строку к содержимому буфера шаблона, затем добавить туда же содержимое дополнительного буфера.  
Утилите можно передать несколько команд, для этого их надо разделить точкой с запятой или использовать две опции -e. Теперь вы знаете всё необходимое и можно переходить к примерам.


**Примеры использования sed**  
Теперь рассмотрим примеры sed Linux, чтобы у вас сложилась целостная картина об этой утилите. Давайте сначала выведем из файла строки с пятой по десятую. Для этого воспользуемся командой -p. Мы используем опцию -n чтобы не выводить содержимое буфера шаблона на каждой итерации, а выводим только то, что нам надо. Если команда одна, то опцию -e можно опустить и писать без неё:


`sed -n '5,10p' /etc/group`


Или можно вывести весь файл, кроме строк с первой по двадцатую:


`sed '1,20d' /etc/group`


Здесь наоборот, опцию -n не указываем, чтобы выводилось всё, а с помощью команды d очищаем ненужное. Дальше рассмотрим замену в sed. Это самая частая функция, которая применяется вместе с этой утилитой. Заменим вхождения слова root на losst в том же файле и выведем всё в стандартный вывод:  
`sed 's/root/losst/g' /etc/group`


Флаг g заменяет все вхождения, также можно использовать флаг i, чтобы сделать регулярное выражение sed не зависимым от регистра. Для команд можно задавать адреса. Например, давайте выполним замену 0 на 1000, но только в строках с первой по десятую:


`sed '1,10 s/0/1000/g' /etc/group`

